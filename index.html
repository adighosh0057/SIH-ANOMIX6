<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
  <title>ANOMIX - AI Health Chatbot</title>
  <link href="https://fonts.googleapis.com" rel="preconnect"/>
  <link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700;900&display=swap" rel="stylesheet"/>
  <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet"/>
  <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
  <script>
    tailwind.config = {
      darkMode: "class",
      theme: {
        extend: {
          colors: {
            "primary": "#13a4ec",
            "background-light": "#f6f7f8",
            "background-dark": "#101c22",
          },
          fontFamily: {
            "display": ["Inter"]
          },
        },
      },
    }
  </script>
  <style>
    .material-symbols-outlined {
      font-variation-settings:
        'FILL' 0,
        'wght' 400,
        'GRAD' 0,
        'opsz' 24;
    }
  </style>
</head>
<body class="bg-background-light dark:bg-background-dark font-display">
  <div class="flex flex-col h-screen justify-between">

    <!-- Title bar -->
    <header class="bg-primary dark:bg-primary p-4 shadow-md flex justify-center">
      <h1 class="text-white font-extrabold text-xl tracking-wide">ANOMIX</h1>
    </header>

    <!-- Chat area -->
    <div id="chat-container" class="flex-grow overflow-y-auto p-4 space-y-4">
      <div class="flex items-end gap-3">
        <div class="flex-shrink-0">
          <div class="w-10 h-10 rounded-full bg-primary/20 flex items-center justify-center">
            <span class="material-symbols-outlined text-primary">local_hospital</span>
          </div>
        </div>
        <div class="flex-1">
          <div class="bg-white dark:bg-background-dark rounded-lg rounded-bl-none p-3 shadow-sm">
            <p class="text-black dark:text-white text-base">
              Hello! üëã I‚Äôm ANOMIX, your Health Assistant. Describe your symptoms, and I'll try to diagnose and suggest first aid.
            </p>
          </div>
        </div>
      </div>
    </div>

    <!-- Input -->
    <footer class="p-4 border-t border-white/10 dark:border-black/10 bg-background-light dark:bg-background-dark">
      <div class="flex items-center gap-3">
        <input id="user-input"
          class="flex-grow bg-white/50 dark:bg-black/20 border-none rounded-full h-12 px-5 text-black dark:text-white placeholder-black/50 dark:placeholder-white/50 focus:ring-2 focus:ring-primary"
          placeholder="Type your message..." type="text"/>
        <button id="send-btn" class="w-12 h-12 flex-shrink-0 rounded-full bg-primary flex items-center justify-center text-white">
          <span class="material-symbols-outlined">send</span>
        </button>
      </div>
      <p class="text-xs text-center text-black/50 dark:text-white/50 mt-3">For informational purposes only, not a medical diagnosis.</p>
    </footer>
  </div>

  <script>
    // Language selection
    let userLang = null;
    const HINDI_KB = {
      "common cold": {
        overview: "‡§∏‡§æ‡§Æ‡§æ‡§®‡•ç‡§Ø ‡§∏‡§∞‡•ç‡§¶‡•Ä ‡§è‡§ï ‡§π‡§≤‡•ç‡§ï‡§æ ‡§µ‡§æ‡§Ø‡§∞‡§≤ ‡§∏‡§Ç‡§ï‡•ç‡§∞‡§Æ‡§£ ‡§π‡•à‡•§",
        symptoms: ["‡§¨‡§π‡§§‡•Ä ‡§®‡§æ‡§ï", "‡§ó‡§≤‡•á ‡§Æ‡•á‡§Ç ‡§ñ‡§∞‡§æ‡§∂", "‡§õ‡•Ä‡§Ç‡§ï", "‡§ñ‡§æ‡§Ç‡§∏‡•Ä", "‡§π‡§≤‡•ç‡§ï‡§æ ‡§∏‡§ø‡§∞‡§¶‡§∞‡•ç‡§¶", "‡§π‡§≤‡•ç‡§ï‡§æ ‡§¨‡•Å‡§ñ‡§æ‡§∞"],
        prevention: ["‡§π‡§æ‡§• ‡§ß‡•ã‡§è‡§Ç", "‡§ö‡•á‡§π‡§∞‡•á ‡§ï‡•ã ‡§® ‡§õ‡•Å‡§è‡§Ç", "‡§¨‡•Ä‡§Æ‡§æ‡§∞ ‡§≤‡•ã‡§ó‡•ã‡§Ç ‡§∏‡•á ‡§¶‡•Ç‡§∞ ‡§∞‡§π‡•á‡§Ç"],
        treatment: ["‡§Ü‡§∞‡§æ‡§Æ ‡§ï‡§∞‡•á‡§Ç", "‡§§‡§∞‡§≤ ‡§™‡§¶‡§æ‡§∞‡•ç‡§• ‡§≤‡•á‡§Ç", "‡§¶‡§∞‡•ç‡§¶ ‡§®‡§ø‡§µ‡§æ‡§∞‡§ï", "‡§®‡§Æ‡§ï ‡§µ‡§æ‡§≤‡§æ ‡§∏‡•ç‡§™‡•ç‡§∞‡•á"],
        seekCare: ["3+ ‡§¶‡§ø‡§® ‡§§‡§ï ‡§§‡•á‡§ú ‡§¨‡•Å‡§ñ‡§æ‡§∞", "‡§∏‡§æ‡§Ç‡§∏ ‡§≤‡•á‡§®‡•á ‡§Æ‡•á‡§Ç ‡§ï‡§†‡§ø‡§®‡§æ‡§à", "‡§∏‡•Ä‡§®‡•á ‡§Æ‡•á‡§Ç ‡§¶‡§∞‡•ç‡§¶"]
      },
      "influenza": {
        overview: "‡§´‡•ç‡§≤‡•Ç ‡§è‡§ï ‡§∏‡§Ç‡§ï‡•ç‡§∞‡§æ‡§Æ‡§ï ‡§∂‡•ç‡§µ‡§∏‡§® ‡§∞‡•ã‡§ó ‡§π‡•à‡•§",
        symptoms: ["‡§§‡•á‡§ú ‡§¨‡•Å‡§ñ‡§æ‡§∞", "‡§Æ‡§æ‡§Ç‡§∏‡§™‡•á‡§∂‡§ø‡§Ø‡•ã‡§Ç ‡§Æ‡•á‡§Ç ‡§¶‡§∞‡•ç‡§¶", "‡§•‡§ï‡§æ‡§®", "‡§∏‡•Ç‡§ñ‡•Ä ‡§ñ‡§æ‡§Ç‡§∏‡•Ä", "‡§†‡§Ç‡§° ‡§≤‡§ó‡§®‡§æ", "‡§∏‡§ø‡§∞‡§¶‡§∞‡•ç‡§¶"],
        prevention: ["‡§µ‡§æ‡§∞‡•ç‡§∑‡§ø‡§ï ‡§ü‡•Ä‡§ï‡§æ‡§ï‡§∞‡§£", "‡§π‡§æ‡§•‡•ã‡§Ç ‡§ï‡•Ä ‡§∏‡§´‡§æ‡§à", "‡§≠‡•Ä‡§°‡§º ‡§∏‡•á ‡§¨‡§ö‡•á‡§Ç"],
        treatment: ["‡§Ü‡§∞‡§æ‡§Æ ‡§ï‡§∞‡•á‡§Ç", "‡§§‡§∞‡§≤ ‡§™‡§¶‡§æ‡§∞‡•ç‡§• ‡§≤‡•á‡§Ç", "‡§è‡§Ç‡§ü‡•Ä‡§µ‡§æ‡§Ø‡§∞‡§≤ ‡§¶‡§µ‡§æ‡§è‡§Ç (‡§°‡•â‡§ï‡•ç‡§ü‡§∞ ‡§∏‡•á)"],
        seekCare: ["‡§∏‡§æ‡§Ç‡§∏ ‡§≤‡•á‡§®‡•á ‡§Æ‡•á‡§Ç ‡§™‡§∞‡•á‡§∂‡§æ‡§®‡•Ä", "‡§≤‡§ó‡§æ‡§§‡§æ‡§∞ ‡§§‡•á‡§ú ‡§¨‡•Å‡§ñ‡§æ‡§∞", "‡§≠‡•ç‡§∞‡§Æ"]
      },
      "covid-19": {
        overview: "‡§ï‡•ã‡§µ‡§ø‡§°-19 ‡§è‡§ï ‡§∂‡•ç‡§µ‡§∏‡§® ‡§∞‡•ã‡§ó ‡§π‡•à ‡§ú‡•ã ‡§ï‡•ã‡§∞‡•ã‡§®‡§æ‡§µ‡§æ‡§Ø‡§∞‡§∏ SARS-CoV-2 ‡§ï‡•á ‡§ï‡§æ‡§∞‡§£ ‡§π‡•ã‡§§‡§æ ‡§π‡•à‡•§",
        symptoms: ["‡§¨‡•Å‡§ñ‡§æ‡§∞", "‡§ñ‡§æ‡§Ç‡§∏‡•Ä", "‡§•‡§ï‡§æ‡§®", "‡§∏‡•ç‡§µ‡§æ‡§¶/‡§ó‡§Ç‡§ß ‡§ï‡§æ ‡§ú‡§æ‡§®‡§æ", "‡§∏‡§æ‡§Ç‡§∏ ‡§ï‡•Ä ‡§§‡§ï‡§≤‡•Ä‡§´", "‡§ó‡§≤‡•á ‡§Æ‡•á‡§Ç ‡§ñ‡§∞‡§æ‡§∂"],
        prevention: ["‡§ü‡•Ä‡§ï‡§æ‡§ï‡§∞‡§£", "‡§Æ‡§æ‡§∏‡•ç‡§ï", "‡§π‡§æ‡§•‡•ã‡§Ç ‡§ï‡•Ä ‡§∏‡§´‡§æ‡§à", "‡§∏‡§æ‡§Æ‡§æ‡§ú‡§ø‡§ï ‡§¶‡•Ç‡§∞‡•Ä"],
        treatment: ["‡§Ü‡§∞‡§æ‡§Æ ‡§ï‡§∞‡•á‡§Ç", "‡§§‡§∞‡§≤ ‡§™‡§¶‡§æ‡§∞‡•ç‡§• ‡§≤‡•á‡§Ç", "‡§∏‡•ç‡§•‡§æ‡§®‡•Ä‡§Ø ‡§∏‡•ç‡§µ‡§æ‡§∏‡•ç‡§•‡•ç‡§Ø ‡§∏‡§≤‡§æ‡§π ‡§ï‡§æ ‡§™‡§æ‡§≤‡§® ‡§ï‡§∞‡•á‡§Ç"],
        seekCare: ["‡§∏‡§æ‡§Ç‡§∏ ‡§≤‡•á‡§®‡•á ‡§Æ‡•á‡§Ç ‡§ï‡§†‡§ø‡§®‡§æ‡§à", "‡§®‡•Ä‡§≤‡•á ‡§π‡•ã‡§Ç‡§†", "‡§≠‡•ç‡§∞‡§Æ", "‡§≤‡§ó‡§æ‡§§‡§æ‡§∞ ‡§∏‡•Ä‡§®‡•á ‡§Æ‡•á‡§Ç ‡§¶‡§∞‡•ç‡§¶"]
      },
      "migraine": {
        overview: "‡§Æ‡§æ‡§á‡§ó‡•ç‡§∞‡•á‡§® ‡§è‡§ï ‡§®‡•ç‡§Ø‡•Ç‡§∞‡•ã‡§≤‡•â‡§ú‡§ø‡§ï‡§≤ ‡§∏‡•ç‡§•‡§ø‡§§‡§ø ‡§π‡•à ‡§ú‡§ø‡§∏‡§Æ‡•á‡§Ç ‡§§‡•á‡§ú ‡§∏‡§ø‡§∞‡§¶‡§∞‡•ç‡§¶, ‡§Æ‡§§‡§≤‡•Ä ‡§Ø‡§æ ‡§™‡•ç‡§∞‡§ï‡§æ‡§∂ ‡§∏‡§Ç‡§µ‡•á‡§¶‡§®‡§∂‡•Ä‡§≤‡§§‡§æ ‡§π‡•ã‡§§‡•Ä ‡§π‡•à‡•§",
        symptoms: ["‡§ß‡§°‡§º‡§ï‡§§‡§æ ‡§∏‡§ø‡§∞‡§¶‡§∞‡•ç‡§¶", "‡§Æ‡§§‡§≤‡•Ä", "‡§â‡§≤‡•ç‡§ü‡•Ä", "‡§™‡•ç‡§∞‡§ï‡§æ‡§∂/‡§Ü‡§µ‡§æ‡§ú ‡§∏‡§Ç‡§µ‡•á‡§¶‡§®‡§∂‡•Ä‡§≤‡§§‡§æ"],
        prevention: ["‡§ü‡•ç‡§∞‡§ø‡§ó‡§∞ ‡§™‡§π‡§ö‡§æ‡§®‡•á‡§Ç ‡§î‡§∞ ‡§¨‡§ö‡•á‡§Ç", "‡§§‡§®‡§æ‡§µ ‡§™‡•ç‡§∞‡§¨‡§Ç‡§ß‡§®", "‡§®‡§ø‡§Ø‡§Æ‡§ø‡§§ ‡§®‡•Ä‡§Ç‡§¶"],
        treatment: ["‡§Ü‡§∞‡§æ‡§Æ ‡§ï‡§∞‡•á‡§Ç", "‡§™‡§æ‡§®‡•Ä ‡§™‡§ø‡§è‡§Ç", "‡§¶‡§∞‡•ç‡§¶ ‡§®‡§ø‡§µ‡§æ‡§∞‡§ï ‡§Ø‡§æ ‡§ü‡•ç‡§∞‡§ø‡§™‡•ç‡§ü‡§æ‡§® (‡§ï‡•á‡§µ‡§≤ ‡§µ‡§Ø‡§∏‡•ç‡§ï‡•ã‡§Ç ‡§ï‡•á ‡§≤‡§ø‡§è)"],
        seekCare: ["‡§Ö‡§¨ ‡§§‡§ï ‡§ï‡§æ ‡§∏‡§¨‡§∏‡•á ‡§ñ‡§∞‡§æ‡§¨ ‡§∏‡§ø‡§∞‡§¶‡§∞‡•ç‡§¶", "‡§®‡•ç‡§Ø‡•Ç‡§∞‡•ã‡§≤‡•â‡§ú‡§ø‡§ï‡§≤ ‡§≤‡§ï‡•ç‡§∑‡§£", "‡§¨‡•Å‡§ñ‡§æ‡§∞ ‡§ï‡•á ‡§∏‡§æ‡§• ‡§ó‡§∞‡•ç‡§¶‡§® ‡§Ö‡§ï‡§°‡§º‡§®‡§æ"]
      },
      "dengue": {
        overview: "‡§°‡•á‡§Ç‡§ó‡•Ç ‡§è‡§ï ‡§Æ‡§ö‡•ç‡§õ‡§∞ ‡§ú‡§®‡§ø‡§§ ‡§µ‡§æ‡§Ø‡§∞‡§≤ ‡§¨‡•Ä‡§Æ‡§æ‡§∞‡•Ä ‡§π‡•à ‡§ú‡•ã ‡§â‡§∑‡•ç‡§£‡§ï‡§ü‡§ø‡§¨‡§Ç‡§ß‡•Ä‡§Ø ‡§ï‡•ç‡§∑‡•á‡§§‡•ç‡§∞‡•ã‡§Ç ‡§Æ‡•á‡§Ç ‡§Ü‡§Æ ‡§π‡•à‡•§",
        symptoms: ["‡§§‡•á‡§ú ‡§¨‡•Å‡§ñ‡§æ‡§∞", "‡§§‡•á‡§ú ‡§∏‡§ø‡§∞‡§¶‡§∞‡•ç‡§¶", "‡§Ü‡§Ç‡§ñ‡•ã‡§Ç ‡§ï‡•á ‡§™‡•Ä‡§õ‡•á ‡§¶‡§∞‡•ç‡§¶", "‡§ú‡•ã‡§°‡§º/‡§Æ‡§æ‡§Ç‡§∏‡§™‡•á‡§∂‡§ø‡§Ø‡•ã‡§Ç ‡§Æ‡•á‡§Ç ‡§¶‡§∞‡•ç‡§¶", "‡§ö‡§ï‡§§‡•ç‡§§‡•á", "‡§Æ‡§§‡§≤‡•Ä"],
        prevention: ["‡§Æ‡§ö‡•ç‡§õ‡§∞ ‡§ï‡•á ‡§ï‡§æ‡§ü‡§®‡•á ‡§∏‡•á ‡§¨‡§ö‡•á‡§Ç", "‡§ñ‡§°‡§º‡•á ‡§™‡§æ‡§®‡•Ä ‡§ï‡•ã ‡§π‡§ü‡§æ‡§è‡§Ç", "‡§Æ‡§ö‡•ç‡§õ‡§∞‡§¶‡§æ‡§®‡•Ä ‡§ï‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡§∞‡•á‡§Ç"],
        treatment: ["‡§§‡§∞‡§≤ ‡§™‡§¶‡§æ‡§∞‡•ç‡§• ‡§≤‡•á‡§Ç", "‡§¨‡•Å‡§ñ‡§æ‡§∞/‡§¶‡§∞‡•ç‡§¶ ‡§ï‡•á ‡§≤‡§ø‡§è ‡§™‡•á‡§∞‡§æ‡§∏‡§ø‡§ü‡§æ‡§Æ‡•ã‡§≤", "NSAIDs ‡§∏‡•á ‡§¨‡§ö‡•á‡§Ç"],
        seekCare: ["‡§§‡•á‡§ú ‡§™‡•á‡§ü ‡§¶‡§∞‡•ç‡§¶", "‡§ñ‡•Ç‡§® ‡§Ü‡§®‡§æ", "‡§≤‡§ó‡§æ‡§§‡§æ‡§∞ ‡§â‡§≤‡•ç‡§ü‡•Ä", "‡§Ö‡§§‡•ç‡§Ø‡§ß‡§ø‡§ï ‡§®‡•Ä‡§Ç‡§¶ ‡§Ü‡§®‡§æ"]
      }
    };
    // Show language selection prompt at start
    window.addEventListener('DOMContentLoaded', () => {
      setTimeout(() => {
        addMessage('Please select your language / ‡§ï‡•É‡§™‡§Ø‡§æ ‡§Ö‡§™‡§®‡•Ä ‡§≠‡§æ‡§∑‡§æ ‡§ö‡•Å‡§®‡•á‡§Ç:', 'bot');
        addMessage('Type "English" or "Hindi" to continue.', 'bot');
      }, 300);
    });
    const DISEASE_KB = {
      "common cold": {
        "overview": "The common cold is a mild viral infection of the upper respiratory tract.",
        "symptoms": ["runny nose", "sore throat", "sneezing", "cough", "mild headache", "low fever"],
        "prevention": ["wash hands", "avoid face touching", "stay clear of sick people"],
        "treatment": ["rest", "fluids", "pain relievers", "saline nasal spray"],
        "seekCare": ["high fever lasting 3+ days", "breathing difficulty", "chest pain"]
      },
      "influenza": {
        "overview": "Flu is a contagious respiratory illness caused by influenza viruses.",
        "symptoms": ["high fever", "muscle aches", "fatigue", "dry cough", "chills", "headache"],
        "prevention": ["annual vaccination", "hand hygiene", "avoid crowds when ill"],
        "treatment": ["rest", "fluids", "antiviral drugs (doctor prescribed)"],
        "seekCare": ["trouble breathing", "persistent high fever", "confusion"]
      },
      "covid-19": {
        "overview": "COVID-19 is a respiratory illness caused by coronavirus SARS-CoV-2.",
        "symptoms": ["fever", "cough", "fatigue", "loss of taste/smell", "shortness of breath", "sore throat"],
        "prevention": ["vaccination", "mask use", "hand hygiene", "social distancing"],
        "treatment": ["rest", "fluids", "follow local health guidance"],
        "seekCare": ["difficulty breathing", "bluish lips", "confusion", "persistent chest pain"]
      },
      "migraine": {
        "overview": "Migraine is a neurological condition causing severe headaches often with nausea or light sensitivity.",
        "symptoms": ["throbbing headache", "nausea", "vomiting", "light/sound sensitivity"],
        "prevention": ["identify and avoid triggers", "stress management", "regular sleep"],
        "treatment": ["rest", "hydration", "pain relievers or triptans adults only"],
        "seekCare": ["worst headache ever", "neurological symptoms", "stiff neck with fever"]
      },
      "dengue": {
        "overview": "Dengue is a mosquito-borne viral disease common in tropical regions.",
        "symptoms": ["high fever", "severe headache", "pain behind eyes", "joint/muscle pain", "rash", "nausea"],
        "prevention": ["avoid mosquito bites", "remove standing water", "use mosquito nets"],
        "treatment": ["fluids", "acetaminophen for fever/pain", "avoid NSAIDs"],
        "seekCare": ["severe abdominal pain", "bleeding", "persistent vomiting", "drowsiness"]
      }
      // Add more diseases and details here
    };

    const greetings = ["hi", "hello", "hey", "hola", "yo", "good morning", "good evening"];
    let lastBotResponse = null;

    function guessDisease(message) {
      const msg = message.toLowerCase();
      for (const [disease, info] of Object.entries(DISEASE_KB)) {
        let matchCount = 0;
        for (const symptom of info.symptoms) {
          if (msg.includes(symptom)) {
            matchCount += 1;
          }
        }
        if (matchCount >= 2) {
          return disease;
        }
      }
      return null;
    }

    function getResponse(message) {
      const lowerMsg = message.toLowerCase();

      // Language selection logic
      if (!userLang) {
        if (lowerMsg.includes('hindi')) {
          userLang = 'hindi';
          return '‡§Ü‡§™‡§®‡•á ‡§π‡§ø‡§Ç‡§¶‡•Ä ‡§ö‡•Å‡§®‡•Ä ‡§π‡•à‡•§ ‡§ï‡•É‡§™‡§Ø‡§æ ‡§Ö‡§™‡§®‡•á ‡§≤‡§ï‡•ç‡§∑‡§£ ‡§≤‡§ø‡§ñ‡•á‡§Ç‡•§';
        } else if (lowerMsg.includes('english')) {
          userLang = 'english';
          return 'You have selected English. Please describe your symptoms.';
        } else {
          return 'Please type "English" or "Hindi" to select your language.';
        }
      }

      // Greeting response
      if (greetings.some(greet => lowerMsg.startsWith(greet))) {
        if (userLang === 'hindi') {
          const greetingResponses = [
            "‡§®‡§Æ‡§∏‡•ç‡§§‡•á, ‡§Æ‡•à‡§Ç ‡§Ü‡§™‡§ï‡•Ä ‡§ï‡•à‡§∏‡•á ‡§Æ‡§¶‡§¶ ‡§ï‡§∞ ‡§∏‡§ï‡§§‡§æ ‡§π‡•Ç‡§Å?",
            "‡§π‡•à‡§≤‡•ã! ‡§ï‡•É‡§™‡§Ø‡§æ ‡§Ö‡§™‡§®‡•á ‡§≤‡§ï‡•ç‡§∑‡§£ ‡§¨‡§§‡§æ‡§è‡§Ç‡•§",
            "‡§∏‡•ç‡§µ‡§æ‡§ó‡§§ ‡§π‡•à! ‡§¨‡§§‡§æ‡§è‡§Ç ‡§Ü‡§™‡§ï‡•ã ‡§ï‡•à‡§∏‡§æ ‡§Æ‡§π‡§∏‡•Ç‡§∏ ‡§π‡•ã ‡§∞‡§π‡§æ ‡§π‡•à‡•§"
          ];
          return greetingResponses[Math.floor(Math.random() * greetingResponses.length)];
        } else {
          const greetingResponses = [
            "Hey, how can I help you today?",
            "Hello! Please describe your symptoms.",
            "Hi there! Tell me how you feel."
          ];
          return greetingResponses[Math.floor(Math.random() * greetingResponses.length)];
        }
      }

      // Disease guess
      const diseaseGuess = guessDisease(lowerMsg);
      if (diseaseGuess) {
        if (userLang === 'hindi') {
          const info = HINDI_KB[diseaseGuess];
          return `‡§Ü‡§™‡§ï‡•á ‡§≤‡§ï‡•ç‡§∑‡§£‡•ã‡§Ç ‡§ï‡•á ‡§Ü‡§ß‡§æ‡§∞ ‡§™‡§∞, ‡§Ü‡§™‡§ï‡•ã ${diseaseGuess} ‡§π‡•ã ‡§∏‡§ï‡§§‡§æ ‡§π‡•à‡•§ ${info.overview} ‡§™‡•ç‡§∞‡§æ‡§•‡§Æ‡§ø‡§ï ‡§â‡§™‡§ö‡§æ‡§∞: ${info.treatment.join(", ")}. ‡§°‡•â‡§ï‡•ç‡§ü‡§∞ ‡§∏‡•á ‡§Æ‡§ø‡§≤‡•á‡§Ç ‡§Ø‡§¶‡§ø: ${info.seekCare.join(", ")}.`;
        } else {
          const info = DISEASE_KB[diseaseGuess];
          return `Based on your symptoms, you might have ${diseaseGuess}. ${info.overview} For first aid, you can: ${info.treatment.join(", ")}. See a doctor if you experience: ${info.seekCare.join(", ")}.`;
        }
      }

      // Fallback
      if (userLang === 'hindi') {
        return "‡§ß‡§®‡•ç‡§Ø‡§µ‡§æ‡§¶‡•§ ‡§ï‡•É‡§™‡§Ø‡§æ ‡§î‡§∞ ‡§≤‡§ï‡•ç‡§∑‡§£ ‡§Ø‡§æ ‡§µ‡§ø‡§µ‡§∞‡§£ ‡§∏‡§æ‡§ù‡§æ ‡§ï‡§∞‡•á‡§Ç ‡§ú‡§ø‡§∏‡§∏‡•á ‡§Æ‡•à‡§Ç ‡§¨‡•á‡§π‡§§‡§∞ ‡§∏‡§π‡§æ‡§Ø‡§§‡§æ ‡§ï‡§∞ ‡§∏‡§ï‡•Ç‡§Ç‡•§";
      } else {
        return "Thanks for sharing. Could you tell me more symptoms or details to help diagnose?";
      }
    }

    function addMessage(message, sender = "user") {
      const chatContainer = document.getElementById("chat-container");

      const wrapper = document.createElement("div");
      wrapper.className = `flex items-end gap-3 ${sender === "user" ? "justify-end" : ""}`;

      if (sender !== "user") {
        const avatarWrap = document.createElement("div");
        avatarWrap.className = "flex-shrink-0";
        const avatar = document.createElement("div");
        avatar.className = "w-10 h-10 rounded-full bg-primary/20 flex items-center justify-center";
        const icon = document.createElement("span");
        icon.className = "material-symbols-outlined text-primary";
        icon.textContent = "local_hospital";
        avatar.appendChild(icon);
        avatarWrap.appendChild(avatar);
        wrapper.appendChild(avatarWrap);
      }

      const bubble = document.createElement("div");
      bubble.className = sender === "user"
        ? "bg-primary text-white rounded-lg rounded-br-none p-3 max-w-xs whitespace-pre-line"
        : "bg-white dark:bg-background-dark text-black dark:text-white rounded-lg rounded-bl-none p-3 max-w-xs shadow-sm whitespace-pre-line";
      bubble.textContent = message;

      if (sender === "user") {
        wrapper.appendChild(bubble);
        const spacer = document.createElement("div");
        spacer.className = "flex-shrink-0 w-10 h-10";
        wrapper.appendChild(spacer);
      } else {
        const contentWrap = document.createElement("div");
        contentWrap.className = "flex-1";
        contentWrap.appendChild(bubble);
        wrapper.appendChild(contentWrap);
      }

      chatContainer.appendChild(wrapper);
      chatContainer.scrollTop = chatContainer.scrollHeight;
    }

    async function sendMessage() {
      const input = document.getElementById("user-input");
      const userMessage = input.value.trim();
      if (!userMessage) return;

      addMessage(userMessage, "user");
      input.value = "";

      // Prevent repetitive bot responses
      let botReply = getResponse(userMessage);
      if (botReply === lastBotResponse) {
        botReply = "Sorry if I'm repeating myself. Could you please provide more details?";
      }
      lastBotResponse = botReply;
      addMessage(botReply, "bot");
    }

    document.getElementById("send-btn").addEventListener("click", sendMessage);
    document.getElementById("user-input").addEventListener("keydown", (e) => {
      if (e.key === "Enter" && !e.shiftKey) {
        e.preventDefault();
        sendMessage();
      }
    });
  </script>
</body>
</html>
